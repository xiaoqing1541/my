var mainCt=doc.getElementById("J-mainCt"),mainCtParent=doc.getElementById("J-mainCt").parentNode,mainTags=doc.getElementById("J-mainTags"),loadNum,loaded,pageObj,currentTag="all",_type,_timeTag=1,orderType={all:0,biding:1,bidit:2,notbid:3,readypay:4,readysign:5,share:6,error:7,syserror:8},typeArr=["all","biding","bidit","notbid","readypay","readysign","share","error","syserror"],main={init:function(){if(loadNum=loaded=0,_type=_p.queryStr("t")||0){if(mui.each(mainTags.querySelectorAll("a"),function(e,a){var t=a.getAttribute("data-href");a.id=="J-"+typeArr[_type]?(wrap.classList.add(t),a.classList.add("active"),doc.getElementById(t).style.display="block"):(wrap.classList.remove(t),a.classList.remove("active"),doc.getElementById(t).style.display="none")}),_type>2){var e=1.6*-(_type-2)*win.rem;mui(".tags_ct").scroll().scrollTo(e<-4.05*win.rem?-4.05*win.rem:e,0,0)}currentTag=typeArr[_type]}pageObj={all:1,biding:1,bidit:1,notbid:1,readypay:1,readysign:1,share:1,error:1,syserror:1},main.getTabCount(),main.getNews(),main.getListData("all"),main.getListData("biding"),main.getListData("bidit"),main.getListData("notbid"),main.getListData("readypay"),main.getListData("readysign"),main.getListData("share")},loadData:function(){pageObj[currentTag]++,main.getListData(currentTag,1)},isLoaded:function(){++loaded==loadNum&&(_p.removeLoading(),mui("#mainContainer").pullRefresh().endPulldownToRefresh(),mui("#mainContainer").pullRefresh().refresh(!0))},getNews:function(){api.url="96",api.method="get",mui.post("api.php",api,function(e){if("0000"==e.code&&e.data.count>0){var a='<i class="ui-badge">'+e.data.count+"</i>";doc.getElementById("J-typeSet").innerHTML=a,doc.querySelector("#topPopover .news").innerHTML="消息公告"+a}},"json")},getTabCount:function(){loadNum++,api.url="55",api.method="get",mui.post("api.php",api,function(e){if(main.isLoaded(),"0000"==e.code){var a=e.data;a.ongoing>0&&(doc.getElementById("J-biding").innerHTML+='<em class="ui-badge">'+a.ongoing+"</em>"),a.got>0&&(doc.getElementById("J-bidit").innerHTML+='<em class="ui-badge">'+a.got+"</em>"),a.not_got_filtered>0&&(doc.getElementById("J-notbid").innerHTML+='<em class="ui-badge">'+a.not_got_filtered+"</em>"),a.pay_pendding>0&&(doc.getElementById("J-readypay").innerHTML+='<em class="ui-badge">'+a.pay_pendding+"</em>"),a.receive_pendding>0&&(doc.getElementById("J-readysign").innerHTML+='<em class="ui-badge">'+a.receive_pendding+"</em>"),a.show_pendding>0&&(doc.getElementById("J-share").innerHTML+='<em class="ui-badge">'+a.show_pendding+"</em>"),main.clearDot();var t=doc.getElementById("J-"+currentTag);"readypay"!=currentTag&&t.querySelector("em")&&t.removeChild(t.querySelector("em"))}else"9997"==e.code?location.href="login.html?redirect=mybids.html?t="+_p.queryStr("t"):mui.toast(e.message)},"json")},getListData:function(e,a){a||loadNum++,api.url="56",api.order_type=orderType[e],api.method="get",api.limit=20,api.time_tag=_timeTag,api.offset=(pageObj[e]-1)*api.limit,mui.post("api.php",api,function(t){if(a||main.isLoaded(),"0000"==t.code)if(t.data.length>0){var i=status=bidTxt=dealText=cover=timeline=returnTxt=sText="",r=1;mui.each(t.data,function(a,t){var d=saveText="",n=t.settlement_bid_price,o=0;switch(t.order_type){case 0:status=" biding",bidTxt="拍卖价：",timeline="正在参与竞拍...",cover=saveText=returnTxt="",dealText="我出价："+t.bid_times+"次",n=t.current_price,t.lock_status?(status+=" locked",d='<a data-id="J-locked">'+(t.lock_user_count>0?t.lock_user_count+"人在拍":"已锁定")+"</a>"):d='<a data-id="J-tobid">继续竞拍</a>';break;case 1:if(status=" bidit",cover=returnTxt="",bidTxt="成交价：",d='<a data-id="J-look">物流详情</a>',timeline=_p.getDateTime(t.end_time),t.sell_price-t.settlement_bid_price>0&&(saveText='<div class="price_save J-gotoGoods"><em>'+(100*(t.sell_price-t.settlement_bid_price)/t.sell_price).toFixed(1)+"%</em>节省</div>"),dealText="成交人："+t.nickname,0==t.pay_status)d+='<a data-id="J-payment">支付成交价</a>';else switch(0==t.product_type&&(d+='<a data-id="J-shareOut" class="moreApp">分享有奖</a>'),t.delivery_code){case-2001:d+='<a data-id="J-service">联系客服</a>';break;case-1004:case-1003:case-1002:case-1001:d+='<a data-id="J-editInfo">完善信息</a><a data-id="J-service">联系客服</a>';break;case 1001:break;case 1002:case 1003:case 1004:case 1005:case 1006:case 1099:case 1103:case 1104:t.show_confirm_trans&&(d+='<a data-id="J-confirm">成交确认书</a>');break;case 2001:case 2002:case 2003:case 2004:case 2005:t.show_confirm_trans&&(d+='<a data-id="J-confirm">成交确认书</a>'),d+='<a data-id="J-toSign">确认收货</a>';break;case 3003:case 3004:t.show_confirm_trans&&(d+='<a data-id="J-confirm">成交确认书</a>');break;case 3001:case 3002:case 3005:t.show_confirm_trans&&(d+='<a data-id="J-confirm">成交确认书</a>'),d+='<a data-id="J-toShare">晒单有奖</a>';break;case 4001:t.show_confirm_trans&&(d+='<a data-id="J-confirm">成交确认书</a>')}break;case 2:status=" notbid",cover=" ui-traded",bidTxt="成交价：",timeline=_p.getDateTime(t.end_time),o=parseInt(t.used_real_bids*t.return_real_bids_percent/100),returnTxt=saveText="",dealText="成交人："+t.nickname,d='<a data-id="J-return">返还拍币</a>';break;case 3:if(status=" buy",cover="",bidTxt="",timeline=_p.getDateTime(t.order_time),saveText="",returnTxt="",dealText="",d='<a data-id="J-look">物流详情</a>',0==t.pay_status)d+='<a data-id="J-cancer">取消订单</a><a data-id="J-payment">支付差价</a>';else switch(0==t.product_type&&(d+='<a data-id="J-shareOut" class="moreApp">分享有奖</a>'),t.delivery_state){case-1:-2001==t.delivery_code?d+='<a data-id="J-service">联系客服</a>':d+='<a data-id="J-editInfo">完善信息</a><a data-id="J-service">联系客服</a>';break;case 2:d+='<a data-id="J-toSign">确认收货</a>';break;case 3:3001!=t.delivery_code&&3002!=t.delivery_code&&3005!=t.delivery_code||(d+='<a data-id="J-toShare">晒单有奖</a>')}break;case 4:status=" notbid",cover=" ui-traded",bidTxt="成交价：",timeline=_p.getDateTime(t.end_time),saveText="",returnTxt=t.return_real_bids>0?"已返还<em>"+t.return_real_bids+"</em>拍币":"已返还<em>"+t.return_shop_bids+"</em>购物币",dealText="成交人："+t.nickname,d=1==t.is_purchase_enable?'<a data-id="J-diffBuy">差价购买</a>':'<a data-id="J-toBidNew">继续竞拍</a>';break;case 6:status=" error",cover="",bidTxt="成交价：",timeline=_p.getDateTime(t.end_time),saveText="",dealText="已自动退款"+t.return_real_bids+"拍币"+(t.return_voucher_bids>0?"/"+t.return_voucher_bids+"赠币":""),d='<a data-id="J-errorIntro" data-real="'+t.return_real_bids+'" data-free="'+t.return_voucher_bids+'">退币说明</a>'}3==t.order_type?(sText='<div class="bid_info J-gotoGoods"><p>市场价：<span>￥'+t.sell_price+"</span></p><p>使用购物币：<span>-￥"+t.pay_shop_bids+'.00</span></p><p class="realpay">实付价格：<span>￥'+t.pay_price+".00</span></p></div>",r=2):sText='<div class="bid_info J-gotoGoods"><p>市场价：<span>￥'+t.sell_price+"</span></p><p><span>"+bidTxt+"</span><i>￥"+n+'</i></p><p class="hidelong">'+dealText+"</p></div>",i+='<div class="ui-block bid_list'+status+'" data-pid="'+t.period_id+'" data-gid="'+t.product_id+'" data-ptype="'+t.product_type+'" data-did="'+t.delivery_id+'" data-oid="'+t.id+'" data-rbids="'+o+'" data-otype="'+r+'" id="'+e+"_"+t.period_id+'"><div class="timeline">'+timeline+"<span>"+t.delivery_title+'</span></div><div class="cover J-gotoGoods'+cover+'"><img src="'+envConfig.imgHost+t.img_cover+'" /></div>'+sText+saveText+'<div class="user_btn"><div class="return_bids">'+returnTxt+'</div><div class="btn_wrap">'+d+"</div></div></div>"}),1==pageObj[e]?doc.getElementById(e).innerHTML=i:doc.getElementById(e).innerHTML+=i,e==currentTag&&(t.data.length<api.limit?1==pageObj[e]?mui("#mainContainer").pullRefresh().disablePullupToRefresh():mui("#mainContainer").pullRefresh().endPullupToRefresh(!0):(mui("#mainContainer").pullRefresh().endPullupToRefresh(!1),mui("#mainContainer").pullRefresh().enablePullupToRefresh()))}else 1==pageObj[e]&&(doc.getElementById(e).innerHTML='<div class="nodata-default"><a href="category.html">去逛逛</a></div>'),e==currentTag&&(pageObj[e]--,mui("#mainContainer").pullRefresh().disablePullupToRefresh(),mui("#mainContainer").pullRefresh().endPullupToRefresh(!0));else"9997"==t.code?win.top.location="login.html?redirect=mybids.html?t="+_p.queryStr("t"):mui.toast(t.message)},"json")},clearDot:function(){api.url="57",api.method="post",api.tab_type=orderType[currentTag],mui.post("api.php",api,function(e){e.code},"json")}};mui.ready(function(){mui.init({pullRefresh:{container:"#mainContainer",down:{callback:main.init},up:{callback:main.loadData}}}),mui(".tags_ct").scroll({scrollY:!1,scrollX:!0,indicators:!1}),setTimeout(function(){main.init()},5),doc.querySelector(".mui-scroll-wrapper").addEventListener("scroll",function(e){0!=e.detail.y&&(e.detail.y<=-.8*win.rem?(mainTags.classList.add("fixed"),mainCt.classList.add("fixed"),wrap.appendChild(mainTags)):(mainTags.classList.remove("fixed"),mainCt.classList.remove("fixed"),mainCtParent.insertBefore(mainTags,mainCt)))}),mui("#J-mainTags").on("tap","a",function(){var e=this.parentNode.parentNode,a=this.getAttribute("data-href");if(currentTag!=a){mui("#mainContainer").pullRefresh().enablePullupToRefresh(),mui("#mainContainer").pullRefresh().refresh(!0),currentTag=a,history.replaceState(null,"","mybids.html?t="+orderType[a]);var t=this.querySelector("em");"readypay"!=a&&t&&(this.removeChild(t),main.clearDot())}e.className.indexOf("fixed")>-1&&mui("#mainContainer").pullRefresh().scrollTo(0,-.8*win.rem,0)}),mui("#J-mainCt").on("tap","a",function(){var e=this.getAttribute("data-id"),a=this.parentNode.parentNode.parentNode,t=a.getAttribute("data-oid"),i=a.getAttribute("data-gid"),r=a.getAttribute("data-pid"),d=a.getAttribute("data-did"),n=a.getAttribute("data-ptype"),o=a.getAttribute("data-otype"),s=a.getAttribute("data-lock");switch(e){case"J-locked":_p.popupLock(s);break;case"J-service":location.href="http://18610331379.udesk.cn/im_client/?web_plugin_id=31594&group_id=45871&cur_title="+doc.title+"&src_url=&cur_url="+location.href+"&pre_url="+location.href;break;case"J-diffBuy":location.href="confirm_order.html?oid="+t;break;case"J-confirm":location.href="confirmation.html?id="+t;break;case"J-payment":location.href="confirm_order.html?oid="+t;break;case"J-look":location.href="order_details.html?t="+o+"&id="+t;break;case"J-tobid":location.href="detail.html?id="+r;break;case"J-toBidNew":location.href="detail.html?gid="+i;break;case"J-errorIntro":location.href="refund_intro.html?real="+(this.getAttribute("data-real")||0)+"&free="+(this.getAttribute("data-free")||0);break;case"J-toSign":var l=["还没有","确认"];a.getAttribute("data-rbids");mui.confirm("","您确认已经收到货了吗？",l,function(e){1==e.index&&(api.url="58",api.method="post",api.order_id=t,mui.post("api.php",api,function(e){"0000"==e.code?location.reload(!0):"vid"==e.code?(_p.vid(),mui.toast("网络异常，请重试")):"9997"==e.code?location.href="login.html?redirect="+location.pathname+location.search+location.hash:mui.toast(wl.message)},"json"))});break;case"J-toShare":location.href="share_add.html?did="+d+"&gt="+n;break;case"J-editInfo":var n=a.getAttribute("data-ptype");location.href="address.html?m=od&t=1&ed=1&id="+t+"&gt="+n+"&lt=1";break;case"J-cancer":var l=["再考虑一下","确认"];a.getAttribute("data-rbids");mui.confirm("",'<p class="tac">确认取消订单？</p>',l,function(e){1==e.index&&(_p.loading(),api.url="59",api.method="post",api.order_id=t,mui.post("api.php",api,function(e){"0000"==e.code?(mui.toast("取消成功"),main.init()):"vid"==e.code?(_p.vid(),mui.toast("网络异常，请重试")):"9997"==e.code?location.href="login.html?redirect="+location.pathname+location.search+location.hash:mui.toast(e.message)},"json"))})}}),mui("#J-mainCt").on("tap",".J-gotoGoods",function(){var e=this.parentNode,a=e.getAttribute("data-pid");e.classList.contains("error")||(location.href="detail.html?id="+a)})});