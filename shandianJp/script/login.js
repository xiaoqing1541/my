"logout"==_p.queryStr("mod")&&(localStorage.removeItem("userInfo"),location.replace("index.html"));var mobileL=doc.getElementById("J-mobile-l"),passwordL=doc.getElementById("J-password-l"),config=JSON.parse(sessionStorage.config),yzmWrap=doc.querySelector(".yzm"),yzm=doc.getElementById("J-yzm"),mobileR=doc.getElementById("J-mobile-r"),getCode=doc.getElementById("J-getCode"),title=doc.getElementById("J-title"),passwordR=doc.getElementById("J-password-r"),code=doc.getElementById("J-code"),t=_p.queryStr("t"),city=JSON.parse(sessionStorage.city),main={init:function(){ua.match(/micromessenger/i)&&"prod"==envConfig.env?doc.querySelector(".third_login").style.display="block":doc.querySelector(".third_login").style.display="none",_p.queryStr("code")&&(_p.loading(),api.method="get",api.url="getWxUnionId",api.code=_p.queryStr("code"),mui.post("api.php",api,function(e){"0000"==e.code?e.unionid?(localStorage.wxUnionId=e.unionid,api.avatar=e.avatar,api.nickname=e.nickname,main.toLogin(2)):(_p.removeLoading(),mui.toast("授权失败")):"vid"==e.code&&(_p.vid(),mui.toast("网络异常，请重试"),_p.removeLoading())},"json")),_agreement=1,main.agreement(),location.hash?(_p.showPage(location.hash,!0),setTimeout(function(){mui.each(doc.querySelectorAll(".ui-view-page"),function(e,t){t.classList.add("tsi")})},200)):(doc.getElementById("login").classList.add("show"),setTimeout(function(){mui.each(doc.querySelectorAll(".ui-view-page"),function(e,t){t.classList.add("tsi")})},200)),"#register"==location.hash?"forget"!=t?(doc.querySelector(".register .ui-navigation .tips-r").style.display="inline-block",doc.title=title.innerHTML="注册",wrap.removeAttribute("data-page0"),doc.getElementById("login").classList.add("show")):doc.title=title.innerHTML="忘记密码":doc.title="登录"},showPosition:function(e){main.latitude=e.coords.latitude,main.longitude=e.coords.longitude},toLogin:function(e){if(localStorage.lastLogin&&(localStorage.lastSecLogin=localStorage.lastLogin),localStorage.lastLogin=(new Date).getTime(),api.method="post",main.latitude&&(api.latitude=main.latitude),main.longitude&&(api.longitude=main.longitude),2==e){api.url="47",api.register_type=2,api.open_id=localStorage.wxUnionId,localStorage.sessionid&&(api.user_session_id=localStorage.sessionid),localStorage.uuid&&(api.uuid=localStorage.uuid);var t=(city.region||"")+" "+(city.city||"");" "!=t&&(api.register_area=t)}else api.url="48",api.mobile_num=_p.trim(mobileL.value),api.password=passwordL.value;_p.loading(),mui.post("api.php",api,function(e){"0000"==e.code?(api.url="43",api.method="get",api.userid=e.data.id,api.token=e.data.token,delete api.nickname,delete api.register_area,mui.post("api.php",api,function(t){if(_p.removeLoading(),"0000"==t.code){t.data.token=e.data.token,localStorage.userInfo=JSON.stringify(t.data);var i=_p.queryStr("redirect")||"index.html";location.replace(i)}else mui.toast(e.message)},"json")):"vid"==e.code?(_p.vid(),mui.toast("网络异常，请重试"),_p.removeLoading()):(_p.removeLoading(),mui.toast(e.message))},"json")},agreement:function(){mui.each(doc.querySelectorAll(".agreement"),function(e,t){_agreement||(t.classList.add("no"),doc.getElementById("J-toLogin").classList.add("dis"),doc.getElementById("J-toRegister").classList.add("dis"))})}};mui.ready(function(){setTimeout(function(){main.init()},5),navigator.geolocation&&navigator.geolocation.getCurrentPosition(main.showPosition),config.login_verify||(config.login_verify=6e4),(new Date).getTime()-localStorage.lastSecLogin<config.login_verify?yzmWrap.style.display="block":yzmWrap.removeAttribute("style"),mui(".main_form").on("tap",".yzm_wrap",function(){doc.getElementById("J-yzmImg").src="vericode.php?t="+(new Date).getTime()}),doc.getElementById("J-toLogin").addEventListener("tap",function(){if(this.classList.contains("dis"))mui.toast("请先同意用户协议");else{if(!/^1[3|4|5|7|8][0-9]\d{8}$/.test(_p.trim(mobileL.value)))return mui.toast("手机号码格式不对"),!1;if(_p.length(passwordL.value)<6)return mui.toast("密码长度最少6位哦"),!1;if(yzmWrap.getAttribute("style")){if(!yzm.value)return mui.toast("请填写验证码"),!1;mui.post("chk_code.php",{code:yzm.value},function(e){"ok"==e?main.toLogin():mui.toast("验证码错误")},"text")}else main.toLogin()}},!1),doc.getElementById("J-getCode").addEventListener("tap",function(){var e=this,i=_p.trim(mobileR.value);if(!e.classList.contains("dis")){if(!/^1[3|4|5|7|8][0-9]\d{8}$/.test(i))return mui.toast("手机号码格式不对"),!1;"forget"!=t?(api.url="49",api.method="get",api.mobile_num=i,_p.loading(),mui.post("api.php",api,function(t){"0000"==t.code?(api.url="18",api.method="post",api.mobile_num=i,api.sms_type=1,mui.post("api.php",api,function(t){if(_p.removeLoading(),"0000"==t.code){e.className="get_code dis",e.innerHTML="<i>60</i>s 后重新获取";var i=setInterval(function(){var t=e.querySelector("i").innerHTML;t>1?e.innerHTML="<i>"+(t-1)+"</i>s 后重新获取":(e.className="get_code",e.innerHTML="获取验证码",clearInterval(i))},1e3)}else mui.toast(t.message)},"json")):"vid"==t.code?(_p.vid(),mui.toast("网络异常，请重试"),_p.removeLoading()):(_p.removeLoading(),mui.toast(t.message))},"json")):(api.url="18",api.method="post",api.mobile_num=i,api.sms_type=2,mui.post("api.php",api,function(t){if("0000"==t.code){e.className="get_code dis",e.innerHTML="<i>60</i>s 后重新获取";var i=setInterval(function(){var t=e.querySelector("i").innerHTML;t>1?e.innerHTML="<i>"+(t-1)+"</i>s 后重新获取":(e.className="get_code",e.innerHTML="获取验证码",clearInterval(i))},1e3)}else"vid"==t.code?(_p.vid(),mui.toast("网络异常，请重试")):mui.toast(t.message)},"json"))}},!1),doc.getElementById("J-toRegister").addEventListener("tap",function(){if(this.classList.contains("dis"))mui.toast("请先同意用户协议");else{var e=this,i=_p.trim(mobileR.value);if(!/^1[3|4|5|7|8][0-9]\d{8}$/.test(i))return mui.toast("手机号码格式不对"),!1;if("2"==e.getAttribute("data-step")){if(_p.length(passwordR.value)<6)return mui.toast("密码长度最少6位哦"),!1;if(api.method="post",api.username=i,api.password=passwordR.value,"forget"==t)api.url="50";else{main.latitude&&(api.latitude=main.latitude),main.longitude&&(api.longitude=main.longitude),api.url="51";var o=(city.region||"")+" "+(city.city||"");" "!=o&&(api.register_area=o),localStorage.sessionid&&(api.user_session_id=localStorage.sessionid),localStorage.uuid&&(api.uuid=localStorage.uuid)}_p.loading(),mui.post("api.php",api,function(e){"0000"==e.code?(api.url="48",api.method="post",localStorage.lastLogin&&(localStorage.lastSecLogin=localStorage.lastLogin),localStorage.lastLogin=(new Date).getTime(),main.latitude&&(api.latitude=main.latitude),main.longitude&&(api.longitude=main.longitude),mui.post("api.php",api,function(t){_p.removeLoading(),"0000"==t.code?(api.url="43",api.method="get",api.userid=t.data.id,api.token=t.data.token,delete api.register_area,mui.post("api.php",api,function(e){if("0000"==e.code){e.data.token=t.data.token,localStorage.userInfo=JSON.stringify(e.data);var i=_p.queryStr("redirect")||"index.html";location.replace(i)}else mui.toast(e.message)},"json")):"vid"==e.code?(_p.vid(),mui.toast("网络异常，请重试")):mui.toast(t.message)},"json")):(_p.removeLoading(),mui.toast(e.message))},"json")}else{if(!code.value)return mui.toast("请输入验证码"),!1;api.url="29",api.method="post",api.mobile_num=i,api.sms_code=code.value,api.sms_type="forget"==t?2:1,mui.post("api.php",api,function(i){if(_p.removeLoading(),"0000"==i.code){var o=doc.querySelectorAll(".reg_step1");mui.each(o,function(e,t){t.style.display="none"}),doc.querySelector(".reg_step2").style.display="block",e.setAttribute("data-step","2"),e.innerHTML="forget"==t?"重置密码":"注册"}else"vid"==i.code?(_p.vid(),mui.toast("网络异常，请重试")):mui.toast(i.message)},"json")}}},!1),wrap.addEventListener("tap",function(e){var i=e.target,o=i.classList;o.contains("view-page")?"#register"==i.getAttribute("data-href")?"forget"!=i.getAttribute("data-param")?(doc.querySelector(".register .ui-navigation .tips-r").style.display="inline-block",doc.title=title.innerHTML="注册"):(t="forget",doc.title=title.innerHTML="忘记密码"):doc.title="登录":o.contains("login-wx")?ua.match(/micromessenger/i)&&(localStorage.removeItem("wxUnionId"),localStorage.wxUnionId?main.toLogin(2):location.replace("https://open.weixin.qq.com/connect/oauth2/authorize?appid=wxdffb4c26433c7b95&redirect_uri="+encodeURIComponent(location.href)+"&response_type=code&scope=snsapi_userinfo#wechat_redirect")):o.contains("agreement")&&(o.contains("no")?(o.remove("no"),o.contains("login")?doc.getElementById("J-toLogin").classList.remove("dis"):doc.getElementById("J-toRegister").classList.remove("dis")):(o.add("no"),o.contains("login")?doc.getElementById("J-toLogin").classList.add("dis"):doc.getElementById("J-toRegister").classList.add("dis")))},!0)});