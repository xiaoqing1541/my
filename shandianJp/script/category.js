!function(t,e,i){var n=0;t.Lazyload=t.Class.extend({init:function(e,i){this.container=this.element=e,this.options=t.extend({selector:"",diff:!1,force:!1,autoDestroy:!0,duration:100},i),this._key=0,this._containerIsNotDocument=9!==this.container.nodeType,this._callbacks={},this._init()},_init:function(){this._initLoadFn(),this.addElements(),this._loadFn(),t.ready(function(){this._loadFn()}.bind(this)),this.resume()},_initLoadFn:function(){var e=this;e._loadFn=this._buffer(function(){e.options.autoDestroy&&0==e._counter&&t.isEmptyObject(e._callbacks)&&e.destroy(),e._loadItems()},e.options.duration,e)},_createLoader:function(t){var e,i,n,a=[];return function(r){return i||(i=!0,t(function(t){for(e=t;n=a.shift();)try{n&&n.apply(null,[e])}catch(t){setTimeout(function(){throw t},0)}})),e?(r&&r.apply(null,[e]),e):(r&&a.push(r),e)}},_buffer:function(e,i,n){function a(){r&&(r.cancel(),r=0),o=t.now(),e.apply(n||this,arguments),s=t.now()}var r,o=0,s=0,i=i||150;return t.extend(function(){!o||s>=o&&t.now()-s>i||s<o&&t.now()-o>8*i?a():(r&&r.cancel(),r=t.later(a,i,null,arguments))},{stop:function(){r&&(r.cancel(),r=0)}})},_getBoundingRect:function(i){var n,a,r,o;if(void 0!==i){n=i.offsetHeight,a=i.offsetWidth;var s=t.offset(i);r=s.left,o=s.top}else n=e.innerHeight,a=e.innerWidth,r=0,o=e.pageYOffset;var l=this.options.diff,c=!1===l?a:l,d=c,u=!1===l?n:l,h=u,m=r+a,f=o+n;return r-=0,m+=d,o-=0,f+=h,{left:r,top:o,right:m,bottom:f}},_cacheWidth:function(t){return t._mui_lazy_width?t._mui_lazy_width:t._mui_lazy_width=t.offsetWidth},_cacheHeight:function(t){return t._mui_lazy_height?t._mui_lazy_height:t._mui_lazy_height=t.offsetHeight},_isCross:function(t,e){var i={};return i.top=Math.max(t.top,e.top),i.bottom=Math.min(t.bottom,e.bottom),i.left=Math.max(t.left,e.left),i.right=Math.min(t.right,e.right),i.bottom>=i.top&&i.right>=i.left},_elementInViewport:function(e,i,n){if(!e.offsetWidth)return!1;var a,r=t.offset(e),o=!0,s=r.left,l=r.top,c={left:s,top:l,right:s+this._cacheWidth(e),bottom:l+this._cacheHeight(e)};return a=this._isCross(i,c),a&&n&&(o=this._isCross(n,c)),o&&a},_loadItems:function(){var e=this;e._containerIsNotDocument&&!e.container.offsetWidth||(e._windowRegion=e._getBoundingRect(),e._containerIsNotDocument&&(e._containerRegion=e._getBoundingRect(this.container)),t.each(e._callbacks,function(t,i){i&&e._loadItem(t,i)}))},_loadItem:function(t,e){var i=this;if(!(e=e||i._callbacks[t]))return!0;var n=e.el,a=!1,r=e.fn;if(i.options.force||i._elementInViewport(n,i._windowRegion,i._containerRegion))try{a=r.call(i,n,t)}catch(t){setTimeout(function(){throw t},0)}return!1!==a&&delete i._callbacks[t],a},addCallback:function(e,i){var n=this,a=n._callbacks,r={el:e,fn:i||t.noop},o=++this._key;a[o]=r,n._windowRegion?n._loadItem(o,r):n.refresh()},addElements:function(e){var i=this;i._counter=i._counter||0;var a=[];!e&&i.options.selector?a=i.container.querySelectorAll(i.options.selector):t.each(e,function(e,n){a=a.concat(t.qsa(i.options.selector,n))}),t.each(a,function(t,e){e.getAttribute("data-lazyload-id")||i.addElement(e)&&(e.setAttribute("data-lazyload-id",n++),i.addCallback(e,i.handle))})},addElement:function(t){return!0},handle:function(){},refresh:function(t){t&&this.addElements(),this._loadFn()},pause:function(){var t=this._loadFn;this._destroyed||(e.removeEventListener("scroll",t),e.removeEventListener("touchmove",t),e.removeEventListener("resize",t),this._containerIsNotDocument&&(this.container.removeEventListener("scrollend",t),this.container.removeEventListener("scroll",t),this.container.removeEventListener("touchmove",t)))},resume:function(){var t=this._loadFn;this._destroyed||(e.addEventListener("scroll",t,!1),e.addEventListener("touchmove",t,!1),e.addEventListener("resize",t,!1),this._containerIsNotDocument&&(this.container.addEventListener("scrollend",t,!1),this.container.addEventListener("scroll",t,!1),this.container.addEventListener("touchmove",t,!1)))},destroy:function(){var e=this;e.pause(),e._callbacks={},t.trigger(this.container,"destory",e),e._destroyed=1}})}(mui,window,document),function(t,e,i){var n=t.Lazyload.extend({init:function(t,e){this._super(t,e)},_init:function(){this.options.selector="[data-lazyload]",this._super()},_set:function(t,e){"IMG"===t.tagName?t.src=e:t.style.backgroundImage="url("+e+")"},_hasPlaceholder:function(t){return!!t.offsetWidth&&("IMG"===t.tagName?!!t.src:!!t.style.backgroundImage)},_addPlaceHolder:function(t){var e=this;"IMG"===t.tagName?(e._counter++,t.onload=function(){e._counter--,e.addCallback(t,e.handle),this.onload=null},e.onPlaceHolder(function(i){e._set(t,i)})):t.style.backgroundImage="url("+e.options.placeholder+")"},addElement:function(t){var e=this;return!!t.getAttribute("data-lazyload")&&(e._hasPlaceholder(t)?e.addCallback(t,e.handle):(e.onPlaceHolder=e._createLoader(function(t){var i=new Image,n=e.options.placeholder;i.src=n,i.onload=i.onerror=function(){t(n)}}),e._addPlaceHolder(t)),!0)},set:function(e,i){var n=this,a=new Image;a.onload=function(){n._set(e,i),t.trigger(n.element,"success",{element:e,uri:i})},a.onerror=function(){t.trigger(n.element,"error",{element:e,uri:i})},a.src=i,e.removeAttribute("data-lazyload")},handle:function(t,e){var i=t.getAttribute("data-lazyload");i&&this.set(t,i)},destroy:function(){this._super(),this.element.removeAttribute("data-imageLazyload")}});t.fn.imageLazyload=function(a){var r=[];return this.each(function(){var o=this,s=null;o!==i&&o!==e||(o=i.body);var l=o.getAttribute("data-imageLazyload");l?s=t.data[l]:(l=++t.uuid,t.data[l]=s=new n(o,a),o.setAttribute("data-imageLazyload",l)),r.push(s)}),1===r.length?r[0]:r}}(mui,window,document);var mainTags=doc.getElementById("J-mainTags"),mainCt=doc.getElementById("J-mainCt"),cid=_p.queryStr("cid"),pIdArrObj,pageObj,currentTag=cid>0?"list"+cid:"list0",changeTag=!1,freshTime=1e3,tiPr,cTi=null,timespam,listArr,tlArrObj,colorTi={},priceObj,main={refresh:function(){pIdArrObj={list0:[]},tlArrObj={list0:{}},pageObj={list0:1},timespam=(new Date).getTime(),listArr=[],priceObj={},main.getCategory()},loadData:function(){pageObj[currentTag]++,main.getGoodsList(currentTag,0,1)},getCategory:function(){api.url="30",api.method="get",mui.post("api.php",api,function(t){if("0000"==t.code){if(t.data.length>0){var e=ctHtml="";t.data.unshift({id:0,title:"全部商品"}),mui.each(t.data,function(t,i){listArr.push(i.id),pIdArrObj["list"+i.id]=[],pageObj["list"+i.id]=1,tlArrObj["list"+i.id]={},"list"+i.id==currentTag?(e+='<a class="active" data-href="list'+i.id+'">'+i.title+"</a>",ctHtml+='<li style="display:block" id="list'+i.id+'"></li>'):(e+='<a data-href="list'+i.id+'">'+i.title+"</a>",ctHtml+='<li style="display:none" id="list'+i.id+'"></li>')}),mainTags.innerHTML=e,mainCt.innerHTML=ctHtml,main.getGoodsList(currentTag,1)}}else"vid"==t.code?_getingVid||_p.vid(main.getCategory):mui.toast(t.message)},"json")},goodsList:function(t,e,i){var n={html:"",arr:[]};return mui.each(t,function(t,a){-1==i.indexOf(a.id)&&(n.arr.push(a.id),n.html+='<div class="goods ui-mark-'+a.bid_step+'" id="period'+a.id+"_"+e+'" data-pid="'+a.id+'" data-gid="'+a.product_id+'"><a class="cover"><img src="'+envConfig.imgHost+a.img_cover+'" /></a><div class="title">'+a.title+'</div><div class="price_wrap"><div class="price_cur"></div></div><a class="bid_btn"></a></div>')}),n},getGoodsList:function(t,e,i){var n=arguments;api.method="get",api.limit=20,api.offset=(pageObj[t]-1)*api.limit,"list0"==t?api.url="7":(api.url="99",api.category_id=t.substr(4)),mui.post("api.php",api,function(e){if(i||(mui("#mainContainer").pullRefresh().endPulldownToRefresh(),mui("#mainContainer").pullRefresh().refresh(!0),mui("#mainContainer").pullRefresh().endPullupToRefresh(!1)),"0000"==e.code){if(e.data.length>0){var a=main.goodsList(e.data,t,pIdArrObj[t]);pIdArrObj[t].length>0?(pIdArrObj[t]=pIdArrObj[t].concat(a.arr),doc.getElementById(t).innerHTML+=a.html):(pIdArrObj[t]=a.arr,doc.getElementById(t).innerHTML=a.html),t==currentTag&&(e.data.length<api.limit?1==pageObj[t]?mui("#mainContainer").pullRefresh().disablePullupToRefresh():mui("#mainContainer").pullRefresh().endPullupToRefresh(!0):(mui("#mainContainer").pullRefresh().endPullupToRefresh(!1),mui("#mainContainer").pullRefresh().enablePullupToRefresh())),main.getBidPrice(),clearInterval(tiPr),tiPr=setInterval(function(){main.getBidPrice()},freshTime)}else 1==pageObj[t]&&(doc.getElementById(t).innerHTML='<div class="ui-nodata"></div>'),t==currentTag&&(pageObj[currentTag]--,mui("#mainContainer").pullRefresh().disablePullupToRefresh(),mui("#mainContainer").pullRefresh().endPullupToRefresh(!0));i||currentTag!=t||(listArr.removeValue(t.substr(4)),mui.each(listArr,function(t,e){main.getGoodsList("list"+e)}))}else"vid"==e.code?_getingVid||_p.vid(main.getGoodsList,n):mui.toast(e.message)},"json")},getBidPrice:function(){var t=pIdArrObj[currentTag];t.length>0&&(api.url="8",api.method="get",api.periods=t.join(),mui.post("api.php",api,function(t){t&&("0000"==t.code?(mui.each(t.data,function(t,e){var i="period"+e.a+"_"+currentTag,n=doc.getElementById(i);if(n){if(changeTag||priceObj[e.a]!=e.d){var a=n.querySelector(".price_cur");priceObj[e.a]&&!changeTag&&(clearTimeout(colorTi[i]),a.className="price_cur tipin",colorTi[i]=setTimeout(function(){a.className="price_cur tipout"},20)),a.innerHTML="￥ "+e.d,priceObj[e.a]=e.d}2!=e.b&&3!=e.b||(n.classList.add("traded"),n.querySelector(".cover").classList.add("ui-traded"),pIdArrObj[currentTag].removeValue(e.a))}}),changeTag=!1):"vid"==t.code?_p.vid():mui.toast(t.message))},"json"))}};mui.ready(function(){setTimeout(function(){_p.tabbar(2),main.refresh()},5),mui.init({pullRefresh:{container:"#mainContainer",down:{callback:main.refresh},up:{callback:main.loadData}}}),mui("#J-mainCt").on("tap","a",function(){var t=this;switch(t.className){case"cover":case"bid_btn":default:location.href="detail.html?id="+(t.parentNode.getAttribute("data-pid")||"")}}),mui("#J-mainTags").on("tap","a",function(){var t=(this.parentNode,this.getAttribute("data-href"));currentTag!=t&&(mui("#mainContainer").pullRefresh().enablePullupToRefresh(),mui("#mainContainer").pullRefresh().refresh(!0),currentTag=t,changeTag=!0,mui("#mainContainer").pullRefresh().scrollTo(0,0,0),history.replaceState(null,"","category.html?cid="+t.substr(4)))})});