_user.id||location.replace("login.html?redirect="+encodeURIComponent(location.pathname+location.search+location.hash));var expend=doc.getElementById("expend"),income=doc.getElementById("income"),change=doc.getElementById("J-change"),loadNum,loaded,pageObj,currentTag="expend",tagType={expend:1,income:2};t=_p.queryStr("t")||1,chance=0,pointType=["积分","赠币","拍币","购物币"],main={init:function(){location.hash?(_p.showPage(location.hash,!0),setTimeout(function(){mui.each(doc.querySelectorAll(".ui-view-page"),function(e,i){i.classList.add("tsi")})},200),main.refresh()):(doc.getElementById("index").classList.add("show"),setTimeout(function(){mui.each(doc.querySelectorAll(".ui-view-page"),function(e,i){i.classList.add("tsi")})},200),_p.loading()),doc.querySelector("#index .points").innerHTML=_user.integration+" 积分","2"==t&&(doc.getElementById("J-mainTags").children[0].className="",doc.getElementById("J-mainTags").children[1].className="active",expend.style.display="none",income.style.display="block",currentTag="income"),api.url="66",api.method="get",mui.post("api.php",api,function(e){if(location.hash||main.refresh(),"0000"==e.code){api.url="67",api.method="get",mui.post("api.php",api,function(e){_p.removeLoading(),"0000"==e.code?change.querySelector(".tips em").innerHTML=e.data.count:mui.toast(e.message)},"json");var i="";mui.each(e.data,function(e,a){var n="";a.exchange_gain>=100&&(n="tid"),i+="<li><i>"+a.exchange_gain+'</i><p class="'+n+'">'+pointType[a.exchange_product_type]+'</p><a data-id="'+a.id+'" data-get="'+a.exchange_gain+'" data-type="'+pointType[a.exchange_product_type]+'" class="change">'+a.exchange_consume+"积分</a></li>"}),change.querySelector(".list").innerHTML=i}else"9997"==e.code?location.replace("login.html?redirect="+encodeURIComponent(location.pathname+location.search+location.hash)):mui.toast(e.message)},"json")},refresh:function(){loadNum=loaded=0,pageObj={expend:1,income:1},expend.innerHTML='<div class="li thead"><div>类型 / 时间</div><div>支出</div></div>',income.innerHTML='<div class="li thead"><div>类型 / 时间</div><div>收益</div></div>',main.getBillList("expend"),main.getBillList("income")},loadData:function(){pageObj[currentTag]++,main.getBillList(currentTag,1)},isLoaded:function(){++loaded==loadNum&&(mui("#mainContainer").pullRefresh().endPulldownToRefresh(),mui("#mainContainer").pullRefresh().refresh(!0),mui("#mainContainer").pullRefresh().endPullupToRefresh(!1))},getBillList:function(e,i){var a,e=e||"expend";switch(i||loadNum++,e){case"income":api.url="68",a=income;break;case"expend":default:api.url="69",a=expend}api.method="get",api.limit=20,api.offset=(pageObj[e]-1)*api.limit,mui.post("api.php",api,function(n){if(i||main.isLoaded(),"0000"==n.code)if(n.data.length>0){var t="";mui.each(n.data,function(i,a){t+='<div class="li"><div><p>'+a.remark+"</p><p>"+_p.getDateTime(a.create_time)+"</p></div><div>"+("income"==e?"+":"-")+a.integration+"积分</div></div>"}),a.innerHTML+=t,e==currentTag&&(n.data.length<api.limit?1==pageObj[e]?mui("#mainContainer").pullRefresh().disablePullupToRefresh():mui("#mainContainer").pullRefresh().endPullupToRefresh(!0):(mui("#mainContainer").pullRefresh().endPullupToRefresh(!1),mui("#mainContainer").pullRefresh().enablePullupToRefresh()))}else 1==pageObj[e]&&(a.innerHTML+='<div class="ui-nodata"></div>'),e==currentTag&&(pageObj[e]--,mui("#mainContainer").pullRefresh().disablePullupToRefresh(),mui("#mainContainer").pullRefresh().endPullupToRefresh(!0));else mui.toast(n.message)},"json")}},mui.ready(function(){setTimeout(function(){main.init()},5),mui.init({pullRefresh:{container:"#mainContainer",down:{callback:main.refresh},up:{callback:main.loadData}}}),mui(".mui-scroll-wrapper").scroll({indicators:!1}),mui("#J-mainTags").on("tap","a",function(){var e=this.getAttribute("data-href");currentTag!=e&&(mui("#mainContainer").pullRefresh().enablePullupToRefresh(),mui("#mainContainer").pullRefresh().refresh(!0),currentTag=e,history.replaceState(null,"",location.pathname+"?t="+tagType[currentTag]+location.hash))}),mui(".wrap").on("tap","a",function(){if(this.classList.contains("change")){var e=["取消","确认兑换"],i=this.getAttribute("data-id"),a=this.getAttribute("data-get"),n=this.getAttribute("data-type"),t=this.innerHTML;mui.confirm('<div class="tac">本次兑换消耗'+t+"</div>",'<p class="tac">您是否确认兑换 <i class="c_main">'+a+"</i> "+n+"</p>",e,function(e){1==e.index&&(api.url="95",api.method="post",api.id=i,mui.post("api.php",api,function(e){"0000"==e.code?(mui.toast("兑换成功 +"+a+n),_user.integration=_user.integration-parseInt(t),localStorage.userInfo=JSON.stringify(_user),main.init()):"vid"==e.code?(_p.vid(),mui.toast("网络异常，请重试")):"9997"==e.code?location.replace("login.html?redirect="+encodeURIComponent(location.pathname+location.search+location.hash)):mui.toast(e.message)},"json"))})}else this.href&&(location.href=this.href)})});