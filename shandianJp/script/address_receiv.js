!function(e,t,i,n){var a=.63*parseFloat(i.documentElement.style.fontSize),r=e.rad2deg=function(e){return e/(Math.PI/180)},o=(e.deg2rad=function(e){return e*(Math.PI/180)},navigator.platform.toLowerCase()),l=navigator.userAgent.toLowerCase(),s=(l.indexOf("iphone")>-1||l.indexOf("ipad")>-1||l.indexOf("ipod")>-1)&&(o.indexOf("iphone")>-1||o.indexOf("ipad")>-1||o.indexOf("ipod")>-1),d=e.Picker=function(e,t){var i=this;i.holder=e,i.options=t||{},i.init(),i.initInertiaParams(),i.calcElementItemPostion(!0),i.bindEvent()};d.prototype.findElementItems=function(){var e=this;return e.elementItems=[].slice.call(e.holder.querySelectorAll("li")),e.elementItems},d.prototype.init=function(){var e=this;e.list=e.holder.querySelector("ul"),e.findElementItems(),e.height=e.holder.offsetHeight,e.r=e.height/2-10,e.d=2*e.r,e.itemHeight=e.elementItems.length>0?e.elementItems[0].offsetHeight:a,e.itemAngle=parseInt(e.calcAngle(.8*e.itemHeight)),e.hightlightRange=e.itemAngle/2,e.visibleRange=90,e.beginAngle=0,e.beginExceed=e.beginAngle-30,e.list.angle=e.beginAngle,s&&(e.list.style.webkitTransformOrigin="center center "+e.r+"px")},d.prototype.calcElementItemPostion=function(e){var t=this;e&&(t.items=[]),t.elementItems.forEach(function(i){var n=t.elementItems.indexOf(i);if(t.endAngle=t.itemAngle*n,i.angle=t.endAngle,i.style.webkitTransformOrigin="center center -"+t.r+"px",i.style.webkitTransform="translateZ("+t.r+"px) rotateX("+-t.endAngle+"deg)",e){var a={};a.text=i.innerHTML||"",a.value=i.getAttribute("data-value")||a.text,t.items.push(a)}}),t.endExceed=t.endAngle+30,t.calcElementItemVisibility(t.beginAngle)},d.prototype.calcAngle=function(e){var t=this,i=b=parseFloat(t.r);e=Math.abs(e);var n=180*parseInt(e/t.d);e%=t.d;var a=(i*i+b*b-e*e)/(2*i*b);return n+r(Math.acos(a))},d.prototype.calcElementItemVisibility=function(e){var t=this;t.elementItems.forEach(function(i){var n=Math.abs(i.angle-e);n<t.hightlightRange?i.classList.add("highlight"):n<t.visibleRange?(i.classList.add("visible"),i.classList.remove("highlight")):(i.classList.remove("highlight"),i.classList.remove("visible"))})},d.prototype.setAngle=function(e){var t=this;t.list.angle=e,t.list.style.webkitTransform="perspective(1000px) rotateY(0deg) rotateX("+e+"deg)",t.calcElementItemVisibility(e)},d.prototype.bindEvent=function(){var t=this,i=0,n=null,a=!1;t.holder.addEventListener(e.EVENT_START,function(e){a=!0,e.preventDefault(),t.list.style.webkitTransition="",n=(e.changedTouches?e.changedTouches[0]:e).pageY,i=t.list.angle,t.updateInertiaParams(e,!0)},!1),t.holder.addEventListener(e.EVENT_END,function(e){a=!1,e.preventDefault(),t.startInertiaScroll(e)},!1),t.holder.addEventListener(e.EVENT_CANCEL,function(e){a=!1,e.preventDefault(),t.startInertiaScroll(e)},!1),t.holder.addEventListener(e.EVENT_MOVE,function(e){if(a){e.preventDefault();var r=(e.changedTouches?e.changedTouches[0]:e).pageY,o=r-n,l=t.calcAngle(o),s=o>0?i-l:i+l;s>t.endExceed&&(s=t.endExceed),s<t.beginExceed&&(s=t.beginExceed),t.setAngle(s),t.updateInertiaParams(e)}},!1),t.list.addEventListener("tap",function(e){elementItem=e.target,"LI"==elementItem.tagName&&t.setSelectedIndex(t.elementItems.indexOf(elementItem),200)},!1)},d.prototype.initInertiaParams=function(){var e=this;e.lastMoveTime=0,e.lastMoveStart=0,e.stopInertiaMove=!1},d.prototype.updateInertiaParams=function(e,t){var i=this,n=e.changedTouches?e.changedTouches[0]:e;if(t)i.lastMoveStart=n.pageY,i.lastMoveTime=e.timeStamp||Date.now(),i.startAngle=i.list.angle;else{var a=e.timeStamp||Date.now();a-i.lastMoveTime>300&&(i.lastMoveTime=a,i.lastMoveStart=n.pageY)}i.stopInertiaMove=!0},d.prototype.startInertiaScroll=function(e){var t=this,i=e.changedTouches?e.changedTouches[0]:e,n=e.timeStamp||Date.now(),a=(i.pageY-t.lastMoveStart)/(n-t.lastMoveTime),r=a>0?-1:1,o=6e-4*r*-1,l=Math.abs(a/o),s=a*l/2,d=t.list.angle,c=t.calcAngle(s)*r,u=c;if(d+c<t.beginExceed&&(c=t.beginExceed-d,l=l*(c/u)*.6),d+c>t.endExceed&&(c=t.endExceed-d,l=l*(c/u)*.6),0==c)return void t.endScroll();t.scrollDistAngle(n,d,c,l)},d.prototype.scrollDistAngle=function(e,t,i,n){var a=this;a.stopInertiaMove=!1,function(e,t,i,n){var r=n/13,o=0;!function e(){if(!a.stopInertiaMove){var n=a.quartEaseOut(o,t,i,r);if(a.setAngle(n),++o>r-1||n<a.beginExceed||n>a.endExceed)return void a.endScroll();setTimeout(e,13)}}()}(0,t,i,n)},d.prototype.quartEaseOut=function(e,t,i,n){return-i*((e=e/n-1)*e*e*e-1)+t},d.prototype.endScroll=function(){var e=this;if(e.list.angle<e.beginAngle)e.list.style.webkitTransition="150ms ease-out",e.setAngle(e.beginAngle);else if(e.list.angle>e.endAngle)e.list.style.webkitTransition="150ms ease-out",e.setAngle(e.endAngle);else{var t=parseInt((e.list.angle/e.itemAngle).toFixed(0));e.list.style.webkitTransition="100ms ease-out",e.setAngle(e.itemAngle*t)}e.triggerChange()},d.prototype.triggerChange=function(t){var i=this;setTimeout(function(){var n=i.getSelectedIndex(),a=i.items[n];!e.trigger||n==i.lastIndex&&!0!==t||e.trigger(i.holder,"change",{index:n,item:a}),i.lastIndex=n,"function"==typeof t&&t()},0)},d.prototype.correctAngle=function(e){var t=this;return e<t.beginAngle?t.beginAngle:e>t.endAngle?t.endAngle:e},d.prototype.setItems=function(e){var t=this;t.items=e||[];var i=[];t.items.forEach(function(e){null!==e&&e!==n&&i.push("<li>"+(e.text||e)+"</li>")}),t.list.innerHTML=i.join(""),t.findElementItems(),t.calcElementItemPostion(),t.setAngle(t.correctAngle(t.list.angle)),t.triggerChange(!0)},d.prototype.getItems=function(){return this.items},d.prototype.getSelectedIndex=function(){var e=this;return parseInt((e.list.angle/e.itemAngle).toFixed(0))},d.prototype.setSelectedIndex=function(e,t,i){var n=this;n.list.style.webkitTransition="";var a=n.correctAngle(n.itemAngle*e);if(t&&t>0){var r=a-n.list.angle;n.scrollDistAngle(Date.now(),n.list.angle,r,t)}else n.setAngle(a);n.triggerChange(i)},d.prototype.getSelectedItem=function(){var e=this;return e.items[e.getSelectedIndex()]},d.prototype.getSelectedValue=function(){var e=this;return(e.items[e.getSelectedIndex()]||{}).value},d.prototype.getSelectedText=function(){var e=this;return(e.items[e.getSelectedIndex()]||{}).text},d.prototype.setSelectedValue=function(e,t,i){var n=this;for(var a in n.items){if(n.items[a].value==e)return void n.setSelectedIndex(a,t,i)}},e.fn&&(e.fn.picker=function(e){return this.each(function(t,i){if(!i.picker)if(e)i.picker=new d(i,e);else{var n=i.getAttribute("data-picker-options"),a=n?JSON.parse(n):{};i.picker=new d(i,a)}}),this[0]?this[0].picker:null},e.ready(function(){e(".mui-picker").picker()}))}(window.mui||window,window,document,void 0),function(e,t){e.dom=function(i){return"string"!=typeof i?i instanceof Array||i[0]&&i.length?[].slice.call(i):[i]:(e.__create_dom_div__||(e.__create_dom_div__=t.createElement("div")),e.__create_dom_div__.innerHTML=i,[].slice.call(e.__create_dom_div__.childNodes))};e.PopPicker=e.Class.extend({init:function(i){var n=this;n.options=i||{},n.options.buttons=n.options.buttons||["取消","确定"],n.panel=e.dom('<div class="mui-poppicker"><div class="mui-poppicker-header"><button class="mui-btn mui-poppicker-btn-cancel">取消</button><button class="mui-btn mui-btn-blue mui-poppicker-btn-ok">确定</button><div class="mui-poppicker-clear"></div></div><div class="mui-poppicker-body"></div></div>')[0],t.body.appendChild(n.panel),n.ok=n.panel.querySelector(".mui-poppicker-btn-ok"),n.cancel=n.panel.querySelector(".mui-poppicker-btn-cancel"),n.body=n.panel.querySelector(".mui-poppicker-body"),n.mask=e.createMask(),n.cancel.innerText=n.options.buttons[0],n.ok.innerText=n.options.buttons[1],n.cancel.addEventListener("tap",function(e){n.hide()},!1),n.ok.addEventListener("tap",function(e){if(n.callback){!1!==n.callback(n.getSelectedItems())&&n.hide()}},!1),n.mask[0].addEventListener("tap",function(){n.hide()},!1),n._createPicker(),n.panel.addEventListener(e.EVENT_START,function(e){e.preventDefault()},!1),n.panel.addEventListener(e.EVENT_MOVE,function(e){e.preventDefault()},!1)},_createPicker:function(){var t=this,i=t.options.layer||1,n=100/i+"%";t.pickers=[];for(var a=1;a<=i;a++){var r=e.dom('<div class="mui-picker"><div class="mui-picker-inner"><div class="mui-pciker-rule mui-pciker-rule-ft"></div><ul class="mui-pciker-list"></ul><div class="mui-pciker-rule mui-pciker-rule-bg"></div></div></div>')[0];r.style.width=n,t.body.appendChild(r);var o=e(r).picker();t.pickers.push(o),r.addEventListener("change",function(e){var t=this.nextSibling;if(t&&t.picker){var i=e.detail||{},n=i.item||{};t.picker.setItems(n.children)}},!1)}},setData:function(e){var t=this;e=e||[],t.pickers[0].setItems(e)},getSelectedItems:function(){for(var e=this,t=[],i=0,n=e.pickers.length;i<n;i++){var a=e.pickers[i];t.push(a.getSelectedItem()||{})}return t},show:function(i){var n=this;n.callback=i,n.mask.show(),t.body.classList.add(e.className("poppicker-active-for-page")),n.panel.classList.add(e.className("active")),n.__back=e.back,e.back=function(){n.hide()}},hide:function(){var i=this;i.disposed||(i.panel.classList.remove(e.className("active")),i.mask.close(),t.body.classList.remove(e.className("poppicker-active-for-page")),e.back=i.__back)},dispose:function(){var e=this;e.hide(),setTimeout(function(){e.panel.parentNode.removeChild(e.panel);for(var t in e)e[t]=null,delete e[t];e.disposed=!0},300)}})}(mui,document);var form=doc.querySelector(".addr-form"),cityButton=doc.querySelector("#J-city div"),roadButton=doc.querySelector("#J-road div"),subBtn=doc.getElementById("J-subBtn"),true_name=doc.getElementById("true_name"),mobile_num=doc.getElementById("mobile_num"),qq_num=doc.getElementById("qq_num"),alipay_num=doc.getElementById("alipay_num"),alipay_name=doc.getElementById("alipay_name"),address_detail=doc.getElementById("address_detail"),boundMobile=doc.getElementById("boundMobile"),boundCode=doc.getElementById("boundCode"),remark=doc.getElementById("remark"),m=_p.queryStr("m"),id=_p.queryStr("id"),lt=_p.queryStr("lt"),gt=_p.queryStr("gt"),t=_p.queryStr("t"),ed=_p.queryStr("ed"),alipay=_p.queryStr("alipay"),cityPicker,roadPicker,dCheck=!1,addr=JSON.parse(localStorage.fullAddr)||{},main={init:function(e){api.url="17",api.method="get",mui.post("api.php",api,function(e){"0000"==e.code?(main.setValue(e.data),main.setMode()):"9993"==e.code?main.setMode(1):"9997"==e.code?location.href="login.html?redirect="+encodeURIComponent(location.href):mui.toast(e.message)},"json"),_user.mobile_num||mui.each(li,function(e,t){t.classList.contains("J-boundMobile")&&(t.style.display="flex")})},setMode:function(e){e?(subBtn.classList.add("save"),subBtn.innerHTML="保存",form.classList.remove("rdonly"),mui.each(doc.querySelectorAll("input,textarea"),function(e,t){t.removeAttribute("readonly")})):(subBtn.classList.remove("save"),subBtn.innerHTML="修改",form.classList.add("rdonly"),mui.each(doc.querySelectorAll("input,textarea"),function(e,t){t.setAttribute("readonly","readonly")}))},setValue:function(e){true_name.value=e.true_name||"",mobile_num.value=e.mobile_num||"",qq_num.value=e.qq_num||"",alipay_num.value=e.alipay_num||"",alipay_name.value=e.alipay_name||"",cityButton.innerText=e.address||"",roadButton.innerText=e.address_street||"",address_detail.value=e.address_detail||"",remark.value=e.remark||""},getCode:function(e,t){for(var t=t||0,i=0,n=addr.length;i<n;i++)if(0==t){if(addr[i].text==e)return addr[i].value}else if(1==t){for(var a=0,r=addr[i].children.length;a<r;a++)if(addr[i].children[a].text==e)return addr[i].children[a].value}else if(2==t)for(var a=0,r=addr[i].children.length;a<r;a++){if(!addr[i].children[a].children)return null;for(var o=0,l=addr[i].children[a].children.length;o<l;o++)if(addr[i].children[a].children[o].text==e)return addr[i].children[a].children[o].value}},getStreet:function(e,t){api.url="13",api.method="get",api.code=e,mui.post("api.php",api,function(e){if("0000"==e.code){var i=[];mui.each(e.data,function(e,t){var n={text:t.name};i.push(n)}),roadPicker.setData(i),roadButton.innerText=t||"请选择",roadButton.setAttribute("data-load","1")}else{if("9997"!=e.code)return mui.toast(e.message),!1;location.href="login.html?redirect="+encodeURIComponent(location.pathname+location.search+location.hash)}},"json")},submit:function(){return true_name.value&&mobile_num.value&&qq_num.value&&alipay_num.value&&alipay_name.value&&address_detail.value&&"请选择"!=cityButton.innerText&&"请选择"!=roadButton.innerText?/^1[3|4|5|7|8][0-9]\d{8}$/.test(mobile_num.value)?-1==qq_num.value.search(/^[1-9]\d{4,11}$/)?(mui.toast("QQ号格式不对"),!1):/^1[3|4|5|7|8][0-9]\d{8}$/.test(alipay_num.value)||/^([a-zA-Z0-9_-])+@([a-zA-Z0-9_-])+(.[a-zA-Z0-9_-])+/.test(alipay_num.value)?(api.url="16",api.method="post",api.true_name=true_name.value,api.mobile_num=mobile_num.value,api.qq_num=qq_num.value,api.alipay_num=alipay_num.value,api.alipay_name=alipay_name.value,api.address=cityButton.innerText,api.address_street=roadButton.innerText,api.address_detail=address_detail.value,api.is_default=1,remark.value&&(api.remark=remark.value),void mui.post("api.php",api,function(e){"0000"==e.code?location.replace("mycenter.html"):"vid"==e.code?(_p.vid(),mui.toast("网络异常，请重试")):"9997"==e.code?location.href="login.html?redirect="+encodeURIComponent(location.href):mui.toast(e.message)},"json")):(mui.toast("支付宝帐号格式不对"),!1):(mui.toast("手机号码格式不对"),!1):(mui.toast("请将地址填写完整"),!1)}};mui.ready(function(){cityPicker=new mui.PopPicker({layer:3}),roadPicker=new mui.PopPicker,cityPicker.setData(addr),setTimeout(function(){main.init()},5),doc.getElementById("J-city").addEventListener("tap",function(e){"addr-form rdonly"!=form.className&&cityPicker.show(function(e){var t=e[0].text+" "+e[1].text+" "+(e[2].text||"");cityButton.parentNode.className="select ui-arr-r ed",cityButton.innerText!=t&&(cityButton.innerText=e[0].text+" "+e[1].text+" "+(e[2].text||""),main.getStreet(e[2].value||e[1].value))})},!1),doc.getElementById("J-road").addEventListener("tap",function(e){"addr-form rdonly"!=form.className&&(roadButton.getAttribute("data-load")?roadPicker.show(function(e){roadButton.innerText=e[0].text}):mui.toast("请先选择城市"))},!1),doc.getElementById("J-getCode").addEventListener("tap",function(e){if(boundMobile.value){var t=this;t.classList.contains("dis")||(api.url="18",api.mobile_num=boundMobile.value,api.sms_type=4,api.method="post",mui.post("api.php",api,function(e){if(0==e.code){t.classList.add("dis"),t.innerHTML="<i>60</i>s 后重新获取";var i=setInterval(function(){var e=t.querySelector("i")?t.querySelector("i").innerHTML:0;e>1?t.innerHTML="<i>"+(e-1)+"</i>s 后重新获取":(t.classList.remove("dis"),t.innerHTML="获取验证码",clearInterval(i))},1e3)}else"vid"==e.code?(_p.vid(),mui.toast("网络异常，请重试")):"9997"==e.code?location.href="login.html?redirect="+encodeURIComponent(location.pathname+location.search+location.hash):mui.toast(e.message)},"json"))}else mui.toast("请填写要绑定的手机")},!1),subBtn.addEventListener("tap",function(e){if(this.classList.contains("save"))if(_user.mobile_num)main.submit();else{if(!/^1[3|4|5|7|8][0-9]\d{8}$/.test(boundMobile.value))return mui.toast("绑定的手机格式不对"),!1;if(6!=_p.length(boundCode.value))return mui.toast("验证码长度不对"),!1;api.url="19",api.method="post",api.mobile_num=boundMobile.value,api.sms_code=boundCode.value,mui.post("api.php",api,function(e){0==e.code?(_user.mobile_num=boundMobile.value,localStorage.userInfo=JSON.stringify(_user),main.submit()):"vid"==e.code?(_p.vid(),mui.toast("网络异常，请重试")):"9997"==e.code?location.href="login.html?redirect="+encodeURIComponent(location.pathname+location.search+location.hash):mui.toast(e.message)},"json")}else main.setMode(1)},!1)});