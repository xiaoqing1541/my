var moneySum=doc.getElementById("J-moneySum"),expend=doc.getElementById("expend"),income=doc.getElementById("income"),t=_p.queryStr("t"),loadNum,loaded,pageObj,currentTag="expend",main={init:function(){_user.id>0?(loadNum=loaded=0,pageObj={expend:1,income:1},expend.innerHTML='<div class="li thead"><div>类型 / 时间</div><div>支出</div></div>',income.innerHTML='<div class="li thead"><div>类型 / 时间</div><div>收益</div></div>',api.url="43",api.method="get",api.userid=_user.id,api.token=_user.token,mui.post("api.php",api,function(e){"0000"==e.code?(e.data.token=_user.token,localStorage.userInfo=JSON.stringify(e.data),_user=JSON.parse(localStorage.userInfo),moneySum.querySelector(".total_main").innerHTML=_user.real_bids,moneySum.querySelector(".total_free").innerHTML=_user.voucher_bids,moneySum.querySelector(".total_buy").innerHTML=_user.shop_bids):"9997"==data.code?location.replace("login.html?redirect="+encodeURIComponent(location.pathname+location.search+location.hash)):mui.toast(data.message)},"json"),main.getNews(),"2"==t&&(doc.getElementById("J-mainTags").children[0].className="",doc.getElementById("J-mainTags").children[1].className="active",expend.style.display="none",income.style.display="block",currentTag="income"),main.getBillList("expend"),main.getBillList("income")):location.replace("login.html?redirect="+encodeURIComponent(location.pathname+location.search+location.hash))},loadData:function(){pageObj[currentTag]++,main.getBillList(currentTag,1)},isLoaded:function(){++loaded==loadNum&&(mui("#mainContainer").pullRefresh().endPulldownToRefresh(),mui("#mainContainer").pullRefresh().refresh(!0))},getNews:function(){api.url="96",api.method="get",mui.post("api.php",api,function(e){if("0000"==e.code&&e.data.count>0){var i='<i class="ui-badge">'+e.data.count+"</i>";doc.getElementById("J-typeSet").innerHTML=i,doc.querySelector("#topPopover .news").innerHTML="消息公告"+i}},"json")},getBillList:function(e,i){var a,e=e||"expend";switch(i||loadNum++,e){case"income":api.url="53",a=income;break;case"expend":default:api.url="54",a=expend}api.method="get",api.limit=20,api.offset=(pageObj[e]-1)*api.limit,mui.post("api.php",api,function(n){if(i||main.isLoaded(),"0000"==n.code)if(n.data.length>0){var t="";mui.each(n.data,function(e,i){t+='<div class="li"><div><p>'+i.biz_type+"</p><p>"+_p.getDateTime(i.create_time)+"</p></div><div>"+i.amount+"</div></div>"}),a.innerHTML+=t,e==currentTag&&(n.data.length<api.limit?1==pageObj[e]?mui("#mainContainer").pullRefresh().disablePullupToRefresh():mui("#mainContainer").pullRefresh().endPullupToRefresh(!0):(mui("#mainContainer").pullRefresh().endPullupToRefresh(!1),mui("#mainContainer").pullRefresh().enablePullupToRefresh()))}else 1==pageObj[e]&&(a.innerHTML+='<div class="ui-nodata"></div>'),e==currentTag&&(pageObj[e]--,mui("#mainContainer").pullRefresh().disablePullupToRefresh(),mui("#mainContainer").pullRefresh().endPullupToRefresh(!0));else mui.toast(n.message)},"json")}};mui.ready(function(){mui.init({pullRefresh:{container:"#mainContainer",down:{callback:main.init},up:{callback:main.loadData}}}),setTimeout(function(){main.init()},5),mui("#J-mainTags").on("tap","a",function(){var e=this.getAttribute("data-href");currentTag!=e&&(mui("#mainContainer").pullRefresh().enablePullupToRefresh(),mui("#mainContainer").pullRefresh().refresh(!0),currentTag=e)})});