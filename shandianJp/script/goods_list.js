var pageTit=doc.getElementById("J-pageTit");_p.queryStr("pr")>0?pageTit.innerHTML=doc.title=_p.queryStr("pr")+"元专区":_p.queryStr("gid")>0?pageTit.innerHTML=doc.title="最新竞拍":"focus"==_p.queryStr("t")?pageTit.innerHTML=doc.title="我收藏的商品":pageTit.innerHTML=doc.title="全部商品";var mainCt=doc.getElementById("J-mainCt"),loadNum,loaded,priceObj,page,currentPID,freshTime=1e3,tlArrObj,cTi=null,tiPr,colorTi={},stateObj,main={refresh:function(){loadNum=loaded=0,priceObj={},tlArrObj={},stateObj={},page=1,currentPID=[],main.getGoodsList(),clearInterval(tiPr),tiPr=setInterval(function(){main.getBidPrice()},freshTime)},loadData:function(){page++,main.getGoodsList(1)},isLoaded:function(){++loaded==loadNum&&(mui("#mainContainer").pullRefresh().endPulldownToRefresh(),mui("#mainContainer").pullRefresh().refresh(!0))},getGoodsList:function(e,i,t){t||loadNum++;var a=_p.queryStr("pr"),r=_p.queryStr("gid");api.url="7",api.method="get",api.limit=20,api.offset=(page-1)*api.limit,r>0?(api.url="36",api.product_id=r):"focus"==_p.queryStr("t")?api.url="46":a>0&&(api.bids_step=a),mui.post("api.php",api,function(e){if(t||main.isLoaded(),"0000"==e.code)if(e.data.length>0){var i=_p.goodsList(e.data,"1",currentPID);currentPID.length>0?(currentPID=currentPID.concat(i.arr),mainCt.innerHTML+=i.html):(currentPID=i.arr,mainCt.innerHTML=i.html),_p.getFocus(i.gid,mainCt),currentPID.length>0&&main.getBidPrice(),e.data.length<api.limit?1==page?mui("#mainContainer").pullRefresh().disablePullupToRefresh():mui("#mainContainer").pullRefresh().endPullupToRefresh(!0):(mui("#mainContainer").pullRefresh().endPullupToRefresh(!1),mui("#mainContainer").pullRefresh().enablePullupToRefresh())}else 1==page&&(mainCt.innerHTML='<div class="ui-nodata"></div>',mui("#mainContainer").pullRefresh().disablePullupToRefresh()),mui("#mainContainer").pullRefresh().endPullupToRefresh(!0);else mui.toast(e.message)},"json")},getBidPrice:function(e,i){var i=currentPID;i.length>0&&(api.url="8",api.method="get",api.periods=i.join(),mui.post("api.php",api,function(e){e&&("0000"==e.code?(mui.each(e.data,function(e,i){var t="period"+i.a+"_1",a=doc.getElementById(t);if(a){if(priceObj[i.a]!=i.d){var r=a.querySelector(".price_cur");priceObj[i.a]&&(clearTimeout(colorTi[t]),r.className="price_cur tipin",colorTi[t]=setTimeout(function(){r.className="price_cur tipout"},20)),r.innerHTML="￥ "+i.d,a.querySelector(".price_tip").innerHTML=i.h||"当前价",(!tlArrObj[i.a]||i.c>tlArrObj[i.a])&&(0==i.b?tlArrObj[i.a]=i.c+1e3:tlArrObj[i.a]=(i.c>1e3*i.i?1e3*i.i:i.c)+1e3),priceObj[i.a]=i.d}else 0==stateObj[i.a]&&1==i.b&&(tlArrObj[i.a]=1e3*i.i+1e3);stateObj[i.a]=i.b,2==i.b||3==i.b?(a.querySelector(".price_wrap").className="price_wrap",a.classList.add("traded"),a.querySelector(".cover").classList.add("ui-traded"),currentPID.removeValue(i.a),a.querySelector(".timeline").innerHTML=_p.getTimeLine(0),tlArrObj[i.a]=0):1==i.b?(a.querySelector(".price_wrap").className="price_wrap tip",a.querySelector(".timeline").className="timeline tip"):a.querySelector(".price_wrap").className="price_wrap"}}),cTi||(cTi=setInterval(function(){mui.each(tlArrObj,function(e,i){var t=doc.querySelector("#period"+e+"_1 .timeline");i>1e3?(i-=1e3,tlArrObj[e]=i,t.innerHTML=_p.getTimeLine(i),1==stateObj[e]?t.classList.add("tips"):t.classList.remove("tips")):0==stateObj[e]&&(tlArrObj[e]=0,t.innerHTML=_p.getTimeLine(0))})},1e3))):"vid"==e.code?_p.vid():mui.toast(e.message))},"json"))}};mui.ready(function(){setTimeout(function(){main.refresh()},5),mui.init({pullRefresh:{container:"#mainContainer",down:{callback:main.refresh},up:{callback:main.loadData}}}),mui("#J-mainCt").on("tap","a",function(){var e=this;switch(e.className){case"add_focus":e.className="add_focus ed",e.innerHTML="已收藏",api.url="9",api.method="post",api.product_id=e.parentNode.getAttribute("data-gid"),mui.post("api.php",api,function(e){"0000"==e.code||("9997"==e.code?location.href="login.html?redirect="+encodeURIComponent(location.href):mui.toast(e.message))},"json");break;case"add_focus ed":var i=["否","是"];mui.confirm("",'<p class="tac">确认要取消收藏吗？</p>',i,function(i){1==i.index&&(e.className="add_focus",e.innerHTML="收藏",api.url="10",api.method="post",api.product_id=e.parentNode.getAttribute("data-gid"),mui.post("api.php",api,function(i){"0000"==i.code?e.parentNode.remove():"9997"==i.code?location.href="login.html?redirect="+encodeURIComponent(location.pathname+location.search):mui.toast(i.message)},"json"))});break;case"cover":case"bid_btn":location.href="detail.html?id="+(e.parentNode.getAttribute("data-pid")||"")}})});