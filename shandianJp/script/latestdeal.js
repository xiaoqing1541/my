!function(e,t,i){var n=0;e.Lazyload=e.Class.extend({init:function(t,i){this.container=this.element=t,this.options=e.extend({selector:"",diff:!1,force:!1,autoDestroy:!0,duration:100},i),this._key=0,this._containerIsNotDocument=9!==this.container.nodeType,this._callbacks={},this._init()},_init:function(){this._initLoadFn(),this.addElements(),this._loadFn(),e.ready(function(){this._loadFn()}.bind(this)),this.resume()},_initLoadFn:function(){var t=this;t._loadFn=this._buffer(function(){t.options.autoDestroy&&0==t._counter&&e.isEmptyObject(t._callbacks)&&t.destroy(),t._loadItems()},t.options.duration,t)},_createLoader:function(e){var t,i,n,a=[];return function(o){return i||(i=!0,e(function(e){for(t=e;n=a.shift();)try{n&&n.apply(null,[t])}catch(e){setTimeout(function(){throw e},0)}})),t?(o&&o.apply(null,[t]),t):(o&&a.push(o),t)}},_buffer:function(t,i,n){function a(){o&&(o.cancel(),o=0),l=e.now(),t.apply(n||this,arguments),r=e.now()}var o,l=0,r=0,i=i||150;return e.extend(function(){!l||r>=l&&e.now()-r>i||r<l&&e.now()-l>8*i?a():(o&&o.cancel(),o=e.later(a,i,null,arguments))},{stop:function(){o&&(o.cancel(),o=0)}})},_getBoundingRect:function(i){var n,a,o,l;if(void 0!==i){n=i.offsetHeight,a=i.offsetWidth;var r=e.offset(i);o=r.left,l=r.top}else n=t.innerHeight,a=t.innerWidth,o=0,l=t.pageYOffset;var s=this.options.diff,d=!1===s?a:s,c=d,u=!1===s?n:s,m=u,h=o+a,f=l+n;return o-=0,h+=c,l-=0,f+=m,{left:o,top:l,right:h,bottom:f}},_cacheWidth:function(e){return e._mui_lazy_width?e._mui_lazy_width:e._mui_lazy_width=e.offsetWidth},_cacheHeight:function(e){return e._mui_lazy_height?e._mui_lazy_height:e._mui_lazy_height=e.offsetHeight},_isCross:function(e,t){var i={};return i.top=Math.max(e.top,t.top),i.bottom=Math.min(e.bottom,t.bottom),i.left=Math.max(e.left,t.left),i.right=Math.min(e.right,t.right),i.bottom>=i.top&&i.right>=i.left},_elementInViewport:function(t,i,n){if(!t.offsetWidth)return!1;var a,o=e.offset(t),l=!0,r=o.left,s=o.top,d={left:r,top:s,right:r+this._cacheWidth(t),bottom:s+this._cacheHeight(t)};return a=this._isCross(i,d),a&&n&&(l=this._isCross(n,d)),l&&a},_loadItems:function(){var t=this;t._containerIsNotDocument&&!t.container.offsetWidth||(t._windowRegion=t._getBoundingRect(),t._containerIsNotDocument&&(t._containerRegion=t._getBoundingRect(this.container)),e.each(t._callbacks,function(e,i){i&&t._loadItem(e,i)}))},_loadItem:function(e,t){var i=this;if(!(t=t||i._callbacks[e]))return!0;var n=t.el,a=!1,o=t.fn;if(i.options.force||i._elementInViewport(n,i._windowRegion,i._containerRegion))try{a=o.call(i,n,e)}catch(e){setTimeout(function(){throw e},0)}return!1!==a&&delete i._callbacks[e],a},addCallback:function(t,i){var n=this,a=n._callbacks,o={el:t,fn:i||e.noop},l=++this._key;a[l]=o,n._windowRegion?n._loadItem(l,o):n.refresh()},addElements:function(t){var i=this;i._counter=i._counter||0;var a=[];!t&&i.options.selector?a=i.container.querySelectorAll(i.options.selector):e.each(t,function(t,n){a=a.concat(e.qsa(i.options.selector,n))}),e.each(a,function(e,t){t.getAttribute("data-lazyload-id")||i.addElement(t)&&(t.setAttribute("data-lazyload-id",n++),i.addCallback(t,i.handle))})},addElement:function(e){return!0},handle:function(){},refresh:function(e){e&&this.addElements(),this._loadFn()},pause:function(){var e=this._loadFn;this._destroyed||(t.removeEventListener("scroll",e),t.removeEventListener("touchmove",e),t.removeEventListener("resize",e),this._containerIsNotDocument&&(this.container.removeEventListener("scrollend",e),this.container.removeEventListener("scroll",e),this.container.removeEventListener("touchmove",e)))},resume:function(){var e=this._loadFn;this._destroyed||(t.addEventListener("scroll",e,!1),t.addEventListener("touchmove",e,!1),t.addEventListener("resize",e,!1),this._containerIsNotDocument&&(this.container.addEventListener("scrollend",e,!1),this.container.addEventListener("scroll",e,!1),this.container.addEventListener("touchmove",e,!1)))},destroy:function(){var t=this;t.pause(),t._callbacks={},e.trigger(this.container,"destory",t),t._destroyed=1}})}(mui,window,document),function(e,t,i){var n=e.Lazyload.extend({init:function(e,t){this._super(e,t)},_init:function(){this.options.selector="[data-lazyload]",this._super()},_set:function(e,t){"IMG"===e.tagName?e.src=t:e.style.backgroundImage="url("+t+")"},_hasPlaceholder:function(e){return!!e.offsetWidth&&("IMG"===e.tagName?!!e.src:!!e.style.backgroundImage)},_addPlaceHolder:function(e){var t=this;"IMG"===e.tagName?(t._counter++,e.onload=function(){t._counter--,t.addCallback(e,t.handle),this.onload=null},t.onPlaceHolder(function(i){t._set(e,i)})):e.style.backgroundImage="url("+t.options.placeholder+")"},addElement:function(e){var t=this;return!!e.getAttribute("data-lazyload")&&(t._hasPlaceholder(e)?t.addCallback(e,t.handle):(t.onPlaceHolder=t._createLoader(function(e){var i=new Image,n=t.options.placeholder;i.src=n,i.onload=i.onerror=function(){e(n)}}),t._addPlaceHolder(e)),!0)},set:function(t,i){var n=this,a=new Image;a.onload=function(){n._set(t,i),e.trigger(n.element,"success",{element:t,uri:i})},a.onerror=function(){e.trigger(n.element,"error",{element:t,uri:i})},a.src=i,t.removeAttribute("data-lazyload")},handle:function(e,t){var i=e.getAttribute("data-lazyload");i&&this.set(e,i)},destroy:function(){this._super(),this.element.removeAttribute("data-imageLazyload")}});e.fn.imageLazyload=function(a){var o=[];return this.each(function(){var l=this,r=null;l!==i&&l!==t||(l=i.body);var s=l.getAttribute("data-imageLazyload");s?r=e.data[s]:(s=++e.uuid,e.data[s]=r=new n(l,a),l.setAttribute("data-imageLazyload",s)),o.push(r)}),1===o.length?o[0]:o}}(mui,window,document);var page=1,mainCt=doc.getElementById("J-mainCt"),html="",fixed=[!1],eti=0,deallistWrap=doc.getElementById("J-deallistWrap"),deallistWrapper=doc.getElementById("J-deallistWrapper"),deallistRoll=doc.getElementById("J-deallistRoll"),tiRollGet,tiRoll,deallistRollHeight=deallistWrap.clientHeight,main={refresh:function(){page=1,eti=0,main.getData(),main.getDeallistRoll()},loadData:function(){page++,main.getData(1)},getDeallistRoll:function(){api.url="34",api.method="get",mui.post("api.php",api,function(e){if(e)if("0000"==e.code){var t="",i=e.data.length;mui.each(e.data,function(e,i){t+='<a class="hidelong" href="detail.html?id='+i.id+'">恭喜<b>'+i.nickname+"</b>以<em>￥"+i.bid_price+"</em>拍到"+i.title+'<img src="'+envConfig.imgHost+i.img_cover+'?imageView2/1/w/50/h/50"></a>'}),deallistRoll.innerHTML=t,clearTimeout(tiRollGet),tiRollGet=setTimeout(function(){var e=arguments.callee;api.url="34",api.method="get",mui.post("api.php",api,function(t){if(t)if("0000"==t.code){var i="";mui.each(t.data,function(e,t){i+='<a class="hidelong" href="detail.html?id='+t.id+'">恭喜<b>'+t.nickname+"</b>以<em>￥"+t.bid_price+"</em>拍到"+t.title+'<img src="'+envConfig.imgHost+t.img_cover+'?imageView2/1/w/50/h/50"></a>'}),deallistRoll.innerHTML+=i,deallistRoll.setAttribute("style","transform:translate3d(0,0,0) translateZ(0); transition-timing-function: cubic-bezier(0.165, 0.84, 0.44, 1); transition-duration: 0;"),deallistRoll.children.length>1&&deallistRoll.removeChild(deallistRoll.children[0]),setTimeout(e,3e3*(t.data.length-1))}else mui.toast(t.message)},"json")},3e3*(i-1)),clearInterval(tiRoll),tiRoll=setInterval(function(){deallistRoll.setAttribute("style","transform:translate3d(0,-"+deallistRollHeight+"px, 0) translateZ(0); transition-timing-function: cubic-bezier(0.165, 0.84, 0.44, 1); transition-duration: 300ms;");var e=function(){deallistRoll.removeEventListener("webkitTransitionEnd",e),deallistRoll.setAttribute("style","transform:translate3d(0,0,0) translateZ(0); transition-timing-function: cubic-bezier(0.165, 0.84, 0.44, 1); transition-duration: 0;"),deallistRoll.children.length>1&&deallistRoll.removeChild(deallistRoll.children[0])};deallistRoll.addEventListener("webkitTransitionEnd",e)},3e3)}else mui.toast(e.message)},"json")},getData:function(e){api.url="100",api.method="get",api.limit=20,api.end_time=eti,api.offset=(page-1)*api.limit,mui.post("api.php",api,function(t){mui("#mainContainer").pullRefresh().endPulldownToRefresh(),mui("#mainContainer").pullRefresh().endPullupToRefresh(!1),mui("#mainContainer").pullRefresh().enablePullupToRefresh(),"0000"==t.code?t.data.length>0?(html=e?mainCt.innerHTML:"",mui.each(t.data,function(e,t){var i="";t.sell_price-t.bid_price>0&&(i="<em>"+(100*(t.sell_price-t.bid_price)/t.sell_price).toFixed(1)+"%</em>节省"),html+='<div class="ui-block deal_list" data-pid="'+t.id+'" data-gid="'+t.product_id+'"><span class="time_line">'+_p.getDateTime(t.end_time)+'</span><span class="cover ui-mark-'+t.bid_step+' ui-traded"><img src="'+envConfig.imgHost+t.img_cover+'" /></span><span class="info_text"><span class="deal_user hidelong">成交人：'+t.nickname+'</span><span class="market_price">市场价：￥'+t.sell_price+'</span><span class="deal_price">成交价：<em>￥'+t.bid_price+'</em></span></span><span class="save_price">'+i+'<a class="bid_btn"></a></span></div>',eti=t.end_time}),mainCt.innerHTML=html,t.data.length<api.limit?1==page?mui("#mainContainer").pullRefresh().disablePullupToRefresh():mui("#mainContainer").pullRefresh().endPullupToRefresh(!0):(mui("#mainContainer").pullRefresh().endPullupToRefresh(!1),mui("#mainContainer").pullRefresh().enablePullupToRefresh())):(1==page&&(mainCt.innerHTML='<div class="ui-nodata"></div>',mui("#mainContainer").pullRefresh().disablePullupToRefresh()),mui("#mainContainer").pullRefresh().endPullupToRefresh(!0)):"9997"==t.code?win.top.location="login.html?redirect=latestdeal.html":mui.toast(t.message)},"json")}};mui.ready(function(){setTimeout(function(){_p.tabbar(1),main.refresh()},5),mui.init({pullRefresh:{container:"#mainContainer",down:{callback:main.refresh},up:{callback:main.loadData}}}),doc.querySelector(".mui-scroll-wrapper").addEventListener("scroll",function(e){0!=e.detail.y&&(e.detail.y<=-.8*win.rem?fixed[0]||(fixed[0]=!fixed[0],deallistWrapper.className="deallist_roll fixed",wrap.appendChild(deallistWrapper)):fixed[0]&&(fixed[0]=!fixed[0],deallistWrapper.className="",deallistWrap.appendChild(deallistWrapper)))}),mui("#J-mainCt").on("tap",".deal_list",function(){location.href="detail.html?id="+this.getAttribute("data-pid")}),mui("#J-mainCt").on("tap",".bid_btn",function(e){e.stopPropagation(),_p.loading(),api.url="36",api.limit=1,api.offset=0,api.product_id=this.parentNode.parentNode.getAttribute("data-gid"),api.method="get",mui.post("api.php",api,function(e){_p.removeLoading(),"0000"==e.code?1==e.data.length&&(location.href="detail.html?id="+e.data[0].id):mui.toast(e.message)},"json")})});