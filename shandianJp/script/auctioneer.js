function cb_login(){main.init()}function cb_user(){main.init()}var id=_p.queryStr("id"),page,freshTime=1e3,tlArrObj,pIdArrObj,priceObj,stateObj,tiRoll,tiPr,tiRollGet,cTi=null,colorTi={},ct=doc.getElementById("goodsList"),_init=1,main={init:function(){ua.indexOf("gogobids")>-1&&sessionStorage.user_id>0&&(api.token=sessionStorage.token,api.userid=sessionStorage.user_id),pIdArrObj=[],tlArrObj={},stateObj={},priceObj={},page=1,main.getGoodsList(),clearInterval(tiPr),tiPr=setInterval(function(){main.getBidPrice()},freshTime)},loadData:function(){page++,main.getGoodsList(1)},getGoodsList:function(e){api.url="26",api.auctioneer_id=id,api.method="get",api.limit=10,api.offset=(page-1)*api.limit,mui.ajax("api.php",{data:api,dataType:"json",type:"post",timeout:1e4,success:function(i){if(_p.removeLoading(),e||(mui("#mainContainer").pullRefresh().endPulldownToRefresh(),mui("#mainContainer").pullRefresh().refresh(!0)),"0000"==i.code){var a=i.data.auctioneer,r=_p.filter(i.data.period_arr);if(e||(doc.querySelector("h1").innerHTML='<img src="'+envConfig.imgHost+a.avatar+'?imageView2/1/w/90/h/90"><b>'+a.name+"</b><em>中国执业拍卖师</em><br>拍卖师编号 <span>"+a.license+"</span>"),r.length>0){var t=_p.goodsList(r,"1",pIdArrObj);pIdArrObj.length>0?(pIdArrObj=pIdArrObj.concat(t.arr),ct.innerHTML+=t.html):(pIdArrObj=t.arr,ct.innerHTML=t.html),main.getBidPrice(),_p.getFocus(t.gid,ct),r.length<api.limit?1==page?mui("#mainContainer").pullRefresh().disablePullupToRefresh():mui("#mainContainer").pullRefresh().endPullupToRefresh(!0):(mui("#mainContainer").pullRefresh().endPullupToRefresh(!1),mui("#mainContainer").pullRefresh().enablePullupToRefresh())}else 1==page&&(ct.innerHTML='<div class="ui-nodata"></div>',mui("#mainContainer").pullRefresh().disablePullupToRefresh()),mui("#mainContainer").pullRefresh().endPullupToRefresh(!0)}else"vid"==i.code?_p.vid(main.getGoodsList):mui.toast(i.message);mui("#mainContainer").pullRefresh().endPulldownToRefresh()},error:function(){_p.removeLoading(),mui.toast("网络异常，请重试")}})},getBidPrice:function(){pIdArrObj.length>0&&(api.url="8",api.method="get",api.periods=pIdArrObj.join(),mui.post("api.php",api,function(e){e&&("0000"==e.code?(mui.each(e.data,function(e,i){var a="period"+i.a+"_1",r=doc.getElementById(a);if(r){if(priceObj[i.a]!=i.d){var t=r.querySelector(".price_cur");priceObj[i.a]&&(clearTimeout(colorTi[a]),t.className="price_cur tipin",colorTi[a]=setTimeout(function(){t.className="price_cur tipout"},20)),t.innerHTML="￥ "+i.d,r.querySelector(".price_tip").innerHTML=i.h||"当前价",(!tlArrObj[i.a]||i.c>tlArrObj[i.a])&&(0==i.b?tlArrObj[i.a]=i.c+1e3:tlArrObj[i.a]=(i.c>1e3*i.i?1e3*i.i:i.c)+1e3),priceObj[i.a]=i.d}else 0==stateObj[i.a]&&1==i.b&&(tlArrObj[i.a]=1e3*i.i+1e3);stateObj[i.a]=i.b,2==i.b||3==i.b?(r.querySelector(".price_wrap").className="price_wrap",r.classList.add("traded"),r.querySelector(".cover").classList.add("ui-traded"),pIdArrObj.removeValue(i.a),r.querySelector(".timeline").innerHTML=_p.getTimeLine(0),tlArrObj[i.a]=0):1==i.b?(r.querySelector(".price_wrap").className="price_wrap tip",r.querySelector(".timeline").className="timeline tip"):r.querySelector(".price_wrap").className="price_wrap"}}),cTi||(cTi=setInterval(function(){mui.each(tlArrObj,function(e,i){var a=doc.querySelector("#period"+e+"_1 .timeline");i>1e3?(i-=1e3,tlArrObj[e]=i,a.innerHTML=_p.getTimeLine(i),1==stateObj[e]?a.classList.add("tips"):a.classList.remove("tips")):0==stateObj[e]&&(tlArrObj[e]=0,a.innerHTML=_p.getTimeLine(0))})},1e3))):"vid"==e.code?_p.vid():mui.toast(e.message))},"json"))}};id||mui.back(),mui.ready(function(){ua.indexOf("gogobids")>-1?sessionStorage.user_id>0||main.init():(_p.loading(),main.init()),mui.init({pullRefresh:{container:"#mainContainer",down:{callback:main.init},up:{callback:main.loadData}}}),mui(".wrap").on("tap","a",function(){var e=this,i=e.className,a=e.parentNode.getAttribute("data-pid"),r=e.parentNode.getAttribute("data-gid");switch(i){case"add_focus":sessionStorage.user_id>0?(e.className="add_focus ed",e.innerHTML="已收藏",api.url="9",api.method="post",api.product_id=r,mui.post("api.php",api,function(e){"0000"==e.code||("9997"==e.code?interactive.forward("login"):mui.toast(e.message))},"json")):interactive.forward("login");break;case"add_focus ed":if(sessionStorage.user_id>0){var t=["否","是"];mui.confirm("",'<p class="tac">确认要取消收藏吗？</p>',t,function(i){1==i.index&&(e.className="add_focus",e.innerHTML="收藏",api.url="10",api.method="post",api.product_id=r,mui.post("api.php",api,function(e){"0000"==e.code||("9997"==e.code?interactive.forward("login"):mui.toast(e.message))},"json"))})}else interactive.forward("login");break;case"cover":case"cover ui-traded":case"bid_btn":var n=e.parentNode;"bid_btn"==i?n.classList.contains("traded")||interactive.forward("detail","null|"+a):interactive.forward("detail","null|"+a);break;default:e.href&&(location.href=e.href)}})});