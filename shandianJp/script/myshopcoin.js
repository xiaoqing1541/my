_user.id||location.replace("login.html?redirect="+encodeURIComponent(location.pathname+location.search+location.hash));var canuse=doc.getElementById("canuse"),used=doc.getElementById("used"),loadNum,loaded,pageObj,currentTag="canuse",tagType={canuse:1,used:2};t=_p.queryStr("t")||1,main={init:function(){doc.querySelector(".coins").innerHTML=_user.shop_bids+' 购物币<a href="h_shopcoins.html">使用规则&gt;</a>',"2"==t&&(doc.getElementById("J-mainTags").children[0].className="",doc.getElementById("J-mainTags").children[1].className="active",canuse.style.display="none",used.style.display="block",currentTag="used"),loadNum=loaded=0,pageObj={canuse:1,used:1},main.getBillList("canuse"),main.getBillList("used")},loadData:function(){pageObj[currentTag]++,main.getBillList(currentTag,1)},isLoaded:function(){++loaded==loadNum&&(mui("#mainContainer").pullRefresh().endPulldownToRefresh(),mui("#mainContainer").pullRefresh().refresh(!0),mui("#mainContainer").pullRefresh().endPullupToRefresh(!1))},getBillList:function(e,i){var a,e=e||"canuse";switch(i||loadNum++,e){case"canuse":api.url="70",a=canuse;break;case"used":default:api.url="71",a=used}api.method="get",api.limit=20,api.offset=(pageObj[e]-1)*api.limit,mui.post("api.php",api,function(t){if(i||main.isLoaded(),"0000"==t.code)if(t.data.length>0){var n="";mui.each(t.data,function(i,a){var t=time=ic=tp="";"canuse"==e?(0==a.product_id?(t=(envConfig.host||"/")+"images/currency.png",time="有效期至：2017-12-31"):(t=envConfig.imgHost+a.img_cover,time=a.will_over_shop_bids+"购物币 "+a.will_over_day+"天后过期",ic='<i class="icon-arrow"></i>'),n+='<a class="item" data-gid="'+a.product_id+'"><div class="img"><img src="'+t+'"></div><p class="total"><em>'+a.bids+'</em> 购物币</p><p class="hidelong">'+a.title+' 可用</p><p class="time">'+time+ic+'</p><i class="tip"></i></a>'):(0==a.product_id?(t=(envConfig.host||"/")+"images/currency.png",time="有效期至：2017-12-31"):(t=envConfig.imgHost+a.img_cover,time=a.will_over_shop_bids+"购物币 "+a.will_over_day+"天后过期",ic='<i class="icon-arrow"></i>'),"2"==a.status?time=" 已过期":time=" 已使用",n+='<a class="item"><div class="img"><img src="'+t+'"></div><p class="total"><em>'+a.bids+'</em> 购物币</p><p class="hidelong">'+a.title+' 可用</p><p class="time">'+_p.getDateTime(a.time)+time+'</p><i class="tip'+tp+'"></i></a>')}),i?a.innerHTML+=n:a.innerHTML=n,e==currentTag&&(t.data.length<api.limit?1==pageObj[e]?mui("#mainContainer").pullRefresh().disablePullupToRefresh():mui("#mainContainer").pullRefresh().endPullupToRefresh(!0):(mui("#mainContainer").pullRefresh().endPullupToRefresh(!1),mui("#mainContainer").pullRefresh().enablePullupToRefresh()))}else 1==pageObj[e]&&(a.innerHTML='<div class="ui-nodata"></div>'),e==currentTag&&(pageObj[e]--,mui("#mainContainer").pullRefresh().disablePullupToRefresh(),mui("#mainContainer").pullRefresh().endPullupToRefresh(!0));else mui.toast(t.message)},"json")}},mui.ready(function(){setTimeout(function(){main.init()},5),mui.init({pullRefresh:{container:"#mainContainer",down:{callback:main.init},up:{callback:main.loadData}}}),mui("#J-mainTags").on("tap","a",function(){var e=this.getAttribute("data-href");currentTag!=e&&(mui("#mainContainer").pullRefresh().enablePullupToRefresh(),mui("#mainContainer").pullRefresh().refresh(!0),currentTag=e,history.replaceState(null,"",location.pathname+"?t="+tagType[currentTag]+location.hash))}),wrap.addEventListener("tap",function(e){var i=e.target,a=i.classList,t=i.parentNode.getAttribute("data-gid");if(a.contains("tip"))t&&("0"==t?location.href="mybids.html?t=3":(_p.loading(),api.url="72",api.method="get",api.product_id=t,mui.post("api.php",api,function(e){_p.removeLoading(),"0000"==e.code?"0"==e.data.order_id?location.href="mybids.html?t=3":location.href="confirm_order.html?oid="+e.data.order_id:mui.toast(e.message)},"json")));else if(a.contains("time"))t&&"0"!=t&&(location.href="shopcoin_d.html?id="+t);else if(a.contains("icon-arrow")){var t=i.parentNode.parentNode.getAttribute("data-gid");t&&"0"!=t&&(location.href="shopcoin_d.html?id="+t)}},!1)});