var mobile=doc.getElementById("J-mobile"),code=doc.getElementById("J-code"),getCode=doc.getElementById("J-getCode"),tips=doc.getElementById("J-tips"),mobileWrap=doc.getElementById("J-mobileWrap"),xgTips=doc.getElementById("J-xgTips"),submit=doc.getElementById("J-submit"),step=_user.mobile_num?1:0;mui.ready(function(){1==step&&(tips.innerHTML="输入手机号"+_user.mobile_num.substring(0,3)+"****"+_user.mobile_num.substring(7)+"接收到的短信验证码",mobileWrap.style.display="none",xgTips.style.display="block",submit.innerHTML="下一步",mobile.value=_user.mobile_num),mui(".ui-form").on("tap","#J-getCode",function(){if(mobile.value){var e=this;"getcode"==e.className&&(0==step||2==step?(api.url="18",api.mobile_num=mobile.value,api.sms_type=4):1==step&&(api.url="28"),api.method="post",mui.post("api.php",api,function(i){if(0==i.code){e.className="getcode dis",e.innerHTML="<i>60</i>s 后重新获取";var t=setInterval(function(){var i=e.querySelector("i")?e.querySelector("i").innerHTML:0;i>1?e.innerHTML="<i>"+(i-1)+"</i>s 后重新获取":(e.className="getcode",e.innerHTML="获取验证码",clearInterval(t))},1e3)}else"vid"==i.code?(_p.vid(),mui.toast("网络异常，请重试")):"9997"==i.code?win.top.location="login.html?redirect=index.html":mui.toast(i.message)},"json"))}else mui.toast("请填写手机号")}),mui(".ui-form").on("tap","#J-submit",function(){if(6!=_p.length(code.value))return mui.toast("验证码长度不对"),!1;if(0==step||2==step){if(!/^1[3|4|5|7|8][0-9]\d{8}$/.test(mobile.value))return mui.toast("手机号码格式不对"),!1;api.url="19",api.method="post",api.mobile_num=mobile.value,api.sms_code=code.value,mui.post("api.php",api,function(e){0==e.code?(_user.mobile_num=mobile.value,localStorage.userInfo=JSON.stringify(_user),win.top.location="mycenter.html"):"vid"==e.code?(_p.vid(),mui.toast("网络异常，请重试")):"9997"==e.code?win.top.location="login.html?redirect=index.html":mui.toast(e.message)},"json")}else 1==step&&(api.url="29",api.method="post",api.mobile_num=_user.mobile_num,api.sms_code=code.value,api.sms_type=3,mui.post("api.php",api,function(e){0==e.code?(step=2,tips.innerHTML="绑定手机号码可以尽最大程度保障您的账户安全",code.value="",getCode.className="getcode",getCode.innerHTML="获取验证码",mobileWrap.style.display="flex",xgTips.style.display="none",submit.innerHTML="确认绑定"):"vid"==e.code?(_p.vid(),mui.toast("网络异常，请重试")):"9997"==e.code?win.top.location="login.html?redirect=index.html":mui.toast(e.message)},"json"))})});